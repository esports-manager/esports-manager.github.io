---
import { getCollection } from "astro:content";
import "../../styles/global.css";

export async function getStaticPaths() {
  const posts = await getCollection("blog");

  return posts
    .filter((post) => !post.data.draft)
    .map((post) => ({ params: { slug: post.slug }, props: { post } }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const canonical = Astro.site
  ? new URL(`/blog/${post.slug}.html`, Astro.site).toString()
  : `/blog/${post.slug}.html`;

const socialImage = post.data.heroImage
  ? Astro.site
    ? new URL(post.data.heroImage, Astro.site).toString()
    : post.data.heroImage
  : "https://esportsmanager.net/assets/pexels-lucie-liz-3165335.jpg";

const formatDate = (date) =>
  new Intl.DateTimeFormat("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  }).format(date);
---

<!doctype html>
<html
  lang="en"
  x-data="{
  darkMode: localStorage.getItem('darkMode')
  ? JSON.parse(localStorage.getItem('darkMode'))
  : window.matchMedia('(prefers-color-scheme: dark)').matches,
  mobileOpen: false,
  toggleDarkMode() {
    this.darkMode = ! this.darkMode;
    localStorage.setItem('darkMode', JSON.stringify(this.darkMode));
  }
}"
  :class="{ 'dark': darkMode, '' : !darkMode }"
  x-init="$watch('darkMode', value => document.body.classList.toggle('dark', value))"
>
  <head>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>{post.data.title} • eSports Manager</title>
    <meta name="description" content={post.data.description} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      type="image/x-icon"
      href="/assets/esportsmanagertrophy.svg"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="canonical" href={canonical} />
    <meta property="og:type" content="article" />
    <meta
      property="og:title"
      content={`${post.data.title} • eSports Manager`}
    />
    <meta property="og:description" content={post.data.description} />
    <meta property="og:url" content={canonical} />
    <meta property="og:image" content={socialImage} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content={`${post.data.title} • eSports Manager`}
    />
    <meta name="twitter:description" content={post.data.description} />
    <meta name="twitter:image" content={socialImage} />
    <meta name="theme-color" content="#1D4ED8" />
  </head>

  <body class="bg-gray-50 dark:bg-slate-900 dark:text-white">
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:bg-white focus:text-black focus:p-2 focus:rounded"
      >Skip to content</a
    >
    <header
      class="fixed z-10 top-0 w-full p-4 text-white bg-blue-500 dark:bg-blue-600"
    >
      <div class="container flex justify-between h-16 mx-auto">
        <a
          rel="noopener noreferrer"
          href="/index.html"
          aria-label="Back to homepage"
          class="flex items-center p-2"
        >
          <img
            src="/assets/esportsmanagertrophy.svg"
            class="w-16"
            alt="eSports Manager logo"
            width="64"
            height="64"
          />
        </a>
        <ul class="items-stretch hidden space-x-3 md:flex text-lg">
          <li class="flex items-center mr-2">
            <i class="bi bi-house-door-fill"></i>
            <a
              rel="noopener noreferrer"
              href="../index.html"
              class="flex px-4 -mb-1 uppercase font-semibold">Home</a
            >
          </li>
          <li class="flex items-center mr-2">
            <i class="bi bi-info-circle-fill"></i>
            <a href="faq.html" class="flex px-4 -mb-1 uppercase font-semibold"
              >FAQ</a
            >
          </li>
          <li class="flex items-center mr-2">
            <i class="bi bi-signpost-2"></i>
            <a
              href="../roadmap.html"
              class="flex px-4 -mb-1 uppercase font-semibold">Roadmap</a
            >
          </li>
          <li class="flex items-center mr-2">
            <i class="bi bi-newspaper"></i>
            <a
              href="../blog.html"
              class="flex px-4 -mb-1 uppercase font-semibold">Blog</a
            >
          </li>
          <li class="flex items-center mr-2">
            <i class="bi bi-github"></i>
            <a
              href="https://github.com/esports-manager/esports-manager"
              target="_blank"
              class="flex items-center px-4 -mb-1 uppercase font-semibold"
              >GitHub</a
            >
          </li>
          <li class="flex items-center mr-2">
            <button
              class="flex items-center px-4 -mb-1 uppercase font-semibold rounded-full py-3 bg-blue-400 hover:bg-blue-300 dark:bg-blue-500 dark:hover:bg-blue-400"
              @click="toggleDarkMode"
              :aria-pressed="darkMode"
              :aria-label="darkMode ? 'Switch to light mode' : 'Switch to dark mode'"
            >
              <span x-show="darkMode === true">
                <i class="bi bi-sun-fill"></i>
              </span>
              <span x-show="darkMode === false">
                <i class="bi bi-moon-fill"></i>
              </span>
            </button>
          </li>
        </ul>
        <button
          class="flex justify-end p-4 md:hidden"
          @click="mobileOpen = !mobileOpen"
          :aria-expanded="mobileOpen.toString()"
          aria-controls="mobile-menu"
          aria-label="Toggle navigation menu"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            class="w-6 h-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
      <nav id="mobile-menu" class="md:hidden" x-show="mobileOpen" x-transition>
        <ul class="px-4 pb-4 space-y-2 text-lg">
          <li>
            <a
              rel="noopener noreferrer"
              href="../index.html"
              class="block px-2 py-2 rounded hover:bg-blue-400/20">Home</a
            >
          </li>
          <li>
            <a
              href="../faq.html"
              class="block px-2 py-2 rounded hover:bg-blue-400/20">FAQ</a
            >
          </li>
          <li>
            <a
              href="../roadmap.html"
              class="block px-2 py-2 rounded hover:bg-blue-400/20">Roadmap</a
            >
          </li>
          <li>
            <a
              href="../blog.html"
              class="block px-2 py-2 rounded hover:bg-blue-400/20">Blog</a
            >
          </li>
          <li>
            <a
              href="https://github.com/esports-manager/esports-manager"
              target="_blank"
              class="block px-2 py-2 rounded hover:bg-blue-400/20">GitHub</a
            >
          </li>
        </ul>
      </nav>
    </header>

    <div class="px-10">
    <main id="main-content" class="pt-28">
      <div
        class="container mx-auto mt-6 px-4 py-5 bg-slate-200 border border-slate-300 dark:bg-slate-800 dark:border-slate-700 rounded-2xl"
      >
        <section class="container mx-auto px-6">
          <a
            href="/blog.html"
            class="text-blue-600 dark:text-blue-300 font-semibold"
            >← Back to blog</a
          >
          <h1 class="mt-4 text-4xl md:text-5xl font-bold tracking-tight">
            {post.data.title}
          </h1>
          <p class="mt-3 text-lg text-slate-700 dark:text-slate-300">
            {post.data.description}
          </p>
          <div
            class="mt-4 flex flex-wrap items-center gap-3 text-sm text-slate-500 dark:text-slate-400"
          >
            <time datetime={post.data.pubDate.toISOString()}
              >Published {formatDate(post.data.pubDate)}</time
            >
            {
              post.data.updatedDate && (
                <span>• Updated {formatDate(post.data.updatedDate)}</span>
              )
            }
          </div>
          {
            post.data.tags.length > 0 && (
              <div class="mt-4 flex flex-wrap gap-2">
                {post.data.tags.map((tag) => (
                  <span class="rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-blue-700 dark:bg-blue-900/40 dark:text-blue-100">
                    {tag}
                  </span>
                ))}
              </div>
            )
          }
        </section>

        {
          post.data.heroImage && (
            <section class="container mx-auto px-6 mt-8">
              <img
                src={post.data.heroImage}
                alt={post.data.title}
                loading="lazy"
                class="h-72 w-full rounded-2xl object-cover"
              />
            </section>
          )
        }

        <section class="container mx-auto px-6 mt-8 pb-16">
          <article
            class="text-slate-700 dark:text-slate-200 space-y-4 [&_h1]:text-3xl [&_h1]:font-bold [&_h2]:text-2xl [&_h2]:font-semibold [&_h3]:text-xl [&_h3]:font-semibold [&_h4]:text-lg [&_h4]:font-semibold [&_ul]:list-disc [&_ul]:pl-6 [&_ul]:space-y-2 [&_ol]:list-decimal [&_ol]:pl-6 [&_ol]:space-y-2 [&_li]:leading-relaxed [&_a]:text-blue-600 [&_a]:underline [&_del]:opacity-60"
          >
            <Content />
          </article>
        </section>
      </div>
    </main>
    </div>

    <footer class="py-6">
      <div
        class="container px-6 mx-auto space-y-6 divide-y dark:divide-gray-600 md:space-y-12 divide-opacity-50"
      >
        <div class="grid justify-center pt-6 lg:justify-between">
          <div
            class="flex flex-col self-center text-sm text-center md:block lg:col-start-1 md:space-x-6"
          >
            <span>©2024-2026 All rights reserved</span>
          </div>
          <div class="flex justify-center pt-4 space-x-4 lg:pt-0 lg:col-end-13">
            <a
              href="mailto:admin@esportsmanager.net"
              title="Email"
              class="flex items-center justify-center w-10 h-10 rounded-full dark:bg-gray-200 dark:text-gray-800"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
                class="w-5 h-5"
              >
                <path
                  d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"
                ></path>
                <path
                  d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"
                ></path>
              </svg>
            </a>
            <a
              href="https://github.com/esports-manager/esports-manager"
              title="GitHub"
              class="flex items-center justify-center w-10 h-10 rounded-full dark:bg-gray-200 dark:text-gray-800"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="currentColor"
                viewBox="0 0 24 24"
                class="w-5 h-5"
              >
                <path
                  d="M10.9,2.1c-4.6,0.5-8.3,4.2-8.8,8.7c-0.5,4.7,2.2,8.9,6.3,10.5C8.7,21.4,9,21.2,9,20.8v-1.6c0,0-0.4,0.1-0.9,0.1 c-1.4,0-2-1.2-2.1-1.9c-0.1-0.4-0.3-0.7-0.6-1C5.1,16.3,5,16.3,5,16.2C5,16,5.3,16,5.4,16c0.6,0,1.1,0.7,1.3,1c0.5,0.8,1.1,1,1.4,1 c0.4,0,0.7-0.1,0.9-0.2c0.1-0.7,0.4-1.4,1-1.8c-2.3-0.5-4-1.8-4-4c0-1.1,0.5-2.2,1.2-3C7.1,8.8,7,8.3,7,7.6C7,7.2,7,6.6,7.3,6 c0,0,1.4,0,2.8,1.3C10.6,7.1,11.3,7,12,7s1.4,0.1,2,0.3C15.3,6,16.8,6,16.8,6C17,6.6,17,7.2,17,7.6c0,0.8-0.1,1.2-0.2,1.4 c0.7,0.8,1.2,1.8,1.2,3c0,2.2-1.7,3.5-4,4c0.6,0.5,1,1.4,1,2.3v2.6c0,0.3,0.3,0.6,0.7,0.5c3.7-1.5,6.3-5.1,6.3-9.3 C22,6.1,16.9,1.4,10.9,2.1z"
                >
                </path>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
